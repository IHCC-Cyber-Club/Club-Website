<script>
async function build() {
    const title = document.getElementById('t').value;
    const date = document.getElementById('d').value;
    const body = document.getElementById('b').value;

    if(!title || !date) return alert("Title and Date required!");

    const slug = title.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');
    const filename = `${date}-${slug}.md`;

    const btn = document.querySelector('.btn');
    btn.innerText = "UPLOADING TO ARCHIVE...";
    btn.disabled = true;

    try {
        const response = await fetch('/api/save-note', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title, date, content: body, filename })
        });

        if (response.ok) {
            alert("AUTO-SAVE SUCCESSFUL!");
            window.location.href = "notes.html"; 
        } else {
            alert("Error: Check GitHub Token permissions.");
        }
    } catch (err) {
        alert("Connection failed.");
    } finally {
        btn.innerText = "GENERATE & SAVE";
        btn.disabled = false;
    }
}
</script>